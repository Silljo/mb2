{"version":3,"sources":["../../src/pages/komunalno/komunalno.module.ts","../../src/pages/komunalno/komunalno.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { KomunalnoPage } from './komunalno';\n\n@NgModule({\n  declarations: [\n    KomunalnoPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(KomunalnoPage),\n  ],\n})\nexport class KomunalnoPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/komunalno/komunalno.module.ts","import { Component } from '@angular/core';\nimport { NavController, NavParams, LoadingController, IonicPage } from 'ionic-angular';\nimport { Validators, FormBuilder, FormGroup } from '@angular/forms';\nimport { Camera, CameraOptions } from '@ionic-native/camera';\nimport * as firebase from 'firebase';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { Observable } from 'rxjs/Rx';\nimport { DatePipe } from '@angular/common';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-komunalno',\n  templateUrl: 'komunalno.html',\n})\n\nexport class KomunalnoPage {\n\n  private komunalno : FormGroup;\n  slika: string;\n  slika_validation: string;\n  uid: string;\n  datum: String = new Date().toISOString();\n  prijave_komunalno_data: Observable<any[]>;\n  komunalno_segment: any;\n  komunalni_redar = 0;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, private formBuilder: FormBuilder, private camera: Camera,\n              public db: AngularFireDatabase, public auth: AngularFireAuth, private datePipe: DatePipe, public loadingCtrl: LoadingController) {\n\n    /*\n    STATUSI:\n    1 - Novi predmet salje se obavijest komunalnom redaru\n    2 - Poslana poruka komunalnom redaru\n    3 - Komunalni redar je oznacio da je vidio poruku i sanje povratnu informaciju korisniku\n    4 - Korisnik je dobio notifikaciju\n    */\n\n    this.komunalno_segment = 'prijava';\n\n    this.komunalno = this.formBuilder.group({\n      hitnost: ['niska', Validators.required],\n      mjesto: ['', Validators.required],\n      opis: ['', Validators.required],\n      slika: [this.slika, Validators.required],\n      kontakt: ['', Validators.required],\n    });\n\n    this.auth.authState.subscribe(data => {\n      if (data && data.uid) {\n\n        //E sad da prvo vidimo da li je to komunalni redar\n        this.db.object(\"/user_profiles/\" + data.uid).valueChanges().subscribe((data_user) => {\n\n          if(data_user['komunalno'])\n          {\n            this.komunalno_segment = 'arhiva';\n            this.komunalni_redar = data_user['komunalno'];\n            this.prijave_komunalno_data = db.list('/komunalno', ref => ref.limitToLast(20).orderByChild('datum_order')).valueChanges();\n            \n          }\n          else\n          {\n            this.prijave_komunalno_data = db.list('/komunalno', ref => ref.limitToLast(20).orderByChild('datum_order')).valueChanges();\n\n          }\n          console.log(this.prijave_komunalno_data);\n        });\n\n\n      }\n    });\n\n\n\n\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad KomunalnoPage');\n  }\n\n  logForm(){\n\n    let loading = this.loadingCtrl.create({\n      content: 'Slanje prijave, molim pričekajte...'\n    });\n\n    loading.present();\n\n    var opis = this.komunalno.value.opis;\n    var mjesto = this.komunalno.value.mjesto;\n    var kontakt = this.komunalno.value.kontakt;\n    var hitnost = this.komunalno.value.hitnost;\n    var datum = new Date();\n    var datum_order = this.datePipe.transform(datum, 'yyyyMMddHHmm');\n    var datum_formated = this.datePipe.transform(datum, 'dd.MM.yyyy. HH:mm');\n\n    this.komunalno.reset();\n\n    this.auth.authState.subscribe(data => {\n\n      if(data.uid)\n      {\n        var storageRef = firebase.storage().ref('komunalno/' + data.uid + '_' + Date.now());\n\n        storageRef.putString(this.slika, firebase.storage.StringFormat.DATA_URL).then(function(snapshot) {\n\n          var newPostKey = firebase.database().ref().child('komunalno').push().key;\n\n          firebase.database().ref('komunalno/' + newPostKey).set({\n              status: 1,\n              image_url: snapshot.downloadURL,\n              opis: opis,\n              mjesto: mjesto,\n              kontakt: kontakt,\n              hitnost: hitnost,\n              uid: data.uid,\n              key: newPostKey,\n              datum_order: datum_order,\n              datum_prijave: datum_formated\n            });\n\n            loading.dismiss();\n\n        });\n      }\n\n      this.slika = '';\n\n    });\n\n  }\n\n  async slika_komunalno()\n  {\n    try{\n\n      const options: CameraOptions = {\n        quality: 50,\n        targetWidth: 1000,\n        targetHeight: 1000,\n        destinationType: this.camera.DestinationType.DATA_URL,\n        encodingType: this.camera.EncodingType.JPEG,\n        mediaType: this.camera.MediaType.PICTURE,\n        saveToPhotoAlbum: false,\n        allowEdit : true,\n        correctOrientation: true\n      }\n\n      await this.camera.getPicture(options).then((imageData) => {\n       // imageData is either a base64 encoded string or a file URI\n       // If it's base64:\n       let base64Image = 'data:image/jpeg;base64,' + imageData;\n       this.slika = base64Image;\n       this.slika_validation = 'true';\n\n      }, (err) => {\n       // Handle error\n      });\n      }\n      catch(e)\n      {\n\n      }\n  }\n\n  azuriraj_status_komunalni_radnik(key)\n  {\n    firebase.database().ref('komunalno/' + key).update({\n        status: 3\n      });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/komunalno/komunalno.ts"],"sourceRoot":""}